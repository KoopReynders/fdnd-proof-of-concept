<!DOCTYPE html>
<html lang="nl">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/styles/style.css">
	<title>Aanwezigheidsoverzicht</title>
</head>
<body>
	<div class="content-wrapper">
		<header>
			<!-- Heading text -->
			<div class="heading-text">
				<h1 class="heading-title">Kloktijden</h1>
				<p class="heading-subtitle">TristanHVA</p>
			</div>
			<!-- View buttons -->
			<div class="view-button">
				<label class="color-switch">
					<input type="checkbox" name="color-mode" id="color-mode" value="1">
					<label for="color-mode" data-off="Ingeklokt" data-on="Uitgeklokt" class="switch-inner"></label>
				</label>
			</div>
		</header>

		<main>
			<!-- Overzicht  -->
			<section class="overzicht">
				<!-- Ingeklokt -->
				<div class="overzicht-ingeklokt component">
					<!-- Check if punches available -->
					<% if (punches.data) { %>
						<!-- Lijst met alle punches met type "clock_in" -->
						<% const clockedIn = punches.data.filter(pu => pu.type === 'clock_in') %>
						<!-- Lijst met alle punches met type "clock_out" -->
						<% const clockedOut = punches.data.filter(pu => pu.type === 'clock_out') %>

						<!-- Check if clockedIn > 0 -->
						<% if (clockedIn.length > 0) { %>
							<% clockedIn.forEach(ci => { %>

								<!-- Filter alle medewerkers met een punch instance -->
								<% const medewerkers = employees.filter(em => em.id === ci.employee_id) %>

								<!-- Vind gegevens van een specifieke medewerker -->
								<% const clockedInMw = medewerkers.find(mw => mw.id === ci.employee_id) %>

								<!-- Tijd van inklokken -->
								<% const clockInDate = new Date(ci.timestamp) %>
								<% const clockedInHours = clockInDate.getHours() %>
								<% const clockedInMinutes = (clockInDate.getMinutes() < 10 ? '0':'') + clockInDate.getMinutes() %>
								<% const clockedInTime = clockedInHours + ':' + clockedInMinutes %>

								<!-- Tijdsverschil tussen inklokken en nu -->
								<% const timeNow = new Date() %>
								<% const timeDiff = (timeNow - clockInDate) %>
								<%# console.log(timeDiff) %>
								<% const diffMinutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60)) %>
								<% const diffHours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)) %>
								<% let timePast %>
								<% if (diffHours > 0) { %>
									<% timePast = `ongeveer ${diffHours} uur geleden` %>
								<% } else{ %>
									<% timePast = `${diffMinutes} minuten geleden` %>
								<% } %>

								<div class="card">
									<picture class="avatar-wrap">
										<!-- <source class="avatar-img" srcset="/assets/avatar.webp" type="image/webp"> -->
										<img class="avatar-img" src="<%- clockedInMw.avatar %>" alt="Avatar van <%- clockedInMw.name %>" width="40" height="40">
									</picture>

									<div class="card-content">
										<h2 class="mw-name"><%- clockedInMw.name %></h2>
										<p class="start-time"><%- clockedInTime %> - <%- timePast %></p>
									</div>
								</div>
							<% }) %>
						<% } else { %>
							<div class="empty-card">
								<picture class="svg-wrap">
									<img class="svg-img" src="/assets/employees.svg" alt="Employees icon" width="40" height="40">
								</picture>

								<div class="empty-card-content">
									<h2 class="empty-text">Er zijn geen medewerkers ingeklokt</h2>
								</div>
							</div>
						<% } %>
					<% } else { %>
						<p>Er zijn geen medewerkers ingeklokt</p>
					<% } %>
				</div>

				<!-- Uitgeklokt -->
				<div class="overzicht-uitgeklokt component">
					<!-- Individuele medewerker -->
					<div class="card">
						<img src="" alt="" width="40" height="40">
						<div class="card-content">
							<h2 class="mw-name">Tristan de Muijnck</h2>
							<p class="start-time">9:30 - 2 minuten geleden</p>
						</div>
					</div>
				</div>
			</section>
		</main>

		<%- include("./modules/MobileNav") %>
	</div>



</body>
</html>